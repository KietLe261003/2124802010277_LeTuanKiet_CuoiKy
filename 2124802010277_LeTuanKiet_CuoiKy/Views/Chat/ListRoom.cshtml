@model IEnumerable<int>
@using _2124802010277_LeTuanKiet_CuoiKy.Models
@{
    DataTiengAnhEntities db = new DataTiengAnhEntities();
    var id = ViewBag.NowId;
    int NowId = (int)id;
    int TypeRoom = (int)ViewBag.TypeRoom;
}
<div class="input-group rounded mb-3">
    <input type="search" class="form-control rounded" placeholder="Search" aria-label="Search"
           aria-describedby="search-addon" />
    <span class="input-group-text border-0" id="search-addon">
        <i class="fas fa-search"></i>
    </span>
</div>
<ul class="nav nav-tabs">
    <li class="nav-item">
        <a class="nav-link active" aria-current="page" href="~/Chat/Index?TypeRoom=1">Cá nhân</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="~/Chat/Index?TypeRoom=2">Lớp học</a>
    </li>
</ul>




@if (TypeRoom == 1)
{
    /*List này dành cho chat cá nhân*/
    <ul class="list-unstyled mb-0">
        @foreach (var item in Model)
        {
            var UserChat = db.Messages.FirstOrDefault(x => x.RoomId == item && x.IdNguoiDung != NowId);
            var User = db.NguoiDungs.FirstOrDefault(x => x.MaKH == UserChat.IdNguoiDung);

            if (User != null)
            {
                <li class="p-2 border-bottom" style="background-color: #eee;">
                    <a href="~/Chat/Index?id=@item&TypeRoom=@TypeRoom" class="d-flex justify-content-between">
                        <div class="d-flex flex-row">
                            <img src="@User.HinhDaiDien" alt="avatar"
                                 class="" style="min-height: 60px; max-height: 60px; min-width: 60px; max-width: 60px; border-radius: 30px; margin-right: 10px">
                            <div class="pt-1">
                                <p class="fw-bold mb-0">@User.HoTenKH</p>
                                <p class="small text-muted">Hello, Are you there?</p>
                            </div>
                        </div>
                    </a>
                </li>
            }
        }
        <li class="p-2 border-bottom" style="background-color: #eee; display: flex; align-items: center; justify-content: center; height: 85px ">
            <button href="#" class="" style="width: 100%; height: 100%; background-color: blueviolet">
                +
            </button>
        </li>
    </ul>
}
else
{
    /*List này dành cho chat cá nhân*/
<ul class="list-unstyled mb-0">
    @foreach (var item in Model)
    {
        var NameRoom = db.Rooms.FirstOrDefault(x => x.RoomId == item).Name;

        if (User != null)
        {
            <li class="p-2 border-bottom" style="background-color: #eee;">
                <a href="~/Chat/Index?id=@item&TypeRoom=@TypeRoom" class="d-flex justify-content-between">
                    <div class="d-flex flex-row">
                        <img src="~/images/r.png" alt="avatar"
                             class="" style="min-height: 60px; max-height: 60px; min-width: 60px; max-width: 60px; border-radius: 30px; margin-right: 10px">
                        <div class="pt-1">
                            <p class="fw-bold mb-0">@NameRoom</p>
                            <p class="small text-muted">Hello, Are you there?</p>
                        </div>
                    </div>
                </a>
            </li>
        }
    }
    <li class="p-2 border-bottom" style="background-color: #eee; display: flex; align-items: center; justify-content: center; height: 85px ">
        <button href="#" class="" style="width: 100%; height: 100%; background-color: blueviolet">
            +
        </button>
    </li>
</ul>
}
